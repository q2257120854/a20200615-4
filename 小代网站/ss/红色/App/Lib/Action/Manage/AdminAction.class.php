<?php global $zym_decrypt;$zym_decrypt['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']=base64_decode('RA==');$zym_decrypt['¯®¥Á®ÀÁ®¥¥¥Ä¯‹Ä¾ı¥ÖÄ¯ııÖ‹ÃıÃ¥ıÃ”']=base64_decode('aW1wb3J0');$zym_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$zym_decrypt['Á®Ã®ÀÁÖÃ‹¥ÁÖÃÖ¯”ÖÁ‹ÃÀıÖ”¾Ã¥ÁÃ']=base64_decode('c3RybGVu'); ?>

<?php  class AdminAction extends CommonAction{public function index(){$adminInfo=$this->isLogin();if (!$adminInfo['status']){$this->error('æ‚¨æ²¡æœ‰æƒé™è¿›è¡Œè¯¥æ“ä½œ');}$adminModel=$GLOBALS['zym_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('Admin');$where=array();$GLOBALS['zym_decrypt']['¯®¥Á®ÀÁ®¥¥¥Ä¯‹Ä¾ı¥ÖÄ¯ııÖ‹ÃıÃ¥ıÃ”'](base64_decode('T1JHLlV0aWwuUGFnZQ=='));$count=$adminModel->where($where)->count();$Page=new Page($count,C('PAGE_NUM_ONE'));$Page->setConfig('header','æ¡è®°å½•,æ¯é¡µæ˜¾ç¤º'.C('PAGE_NUM_ONE').'æ¡');$Page->setConfig('prev','<');$Page->setConfig('next','>');$Page->setConfig('theme',C('PAGE_STYLE'));$show=$Page->show();$list=$adminModel->where($where)->order('id Desc')->limit($Page->firstRow.','.$Page->listRows)->select();$this->assign('list',$list);$this->assign('page',$show);$this->display();}public function add(){$adminInfo=$this->isLogin();if (!$adminInfo['status']){$this->error('æ‚¨æ²¡æœ‰æƒé™è¿›è¡Œè¯¥æ“ä½œ');}if ($this->isPost()){$name=I('username');$pass=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('password');$repass=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('repassword');$status=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('status');if (!$name){$this->error('è¯·è¾“å…¥ç®¡ç†ç”¨æˆ·å');}if (!$pass){$this->error('è¯·è¾“å…¥ç®¡ç†ç™»å½•å¯†ç ');}if ($GLOBALS['zym_decrypt']['Á®Ã®ÀÁÖÃ‹¥ÁÖÃÖ¯”ÖÁ‹ÃÀıÖ”¾Ã¥ÁÃ']($pass)<6){$this->error('ç®¡ç†ç™»å½•å¯†ç é•¿åº¦ä¸èƒ½å°äº 6 ä½');}if ($repass!=$pass){$this->error('ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´');}$adminModel=$GLOBALS['zym_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('Admin');if ($adminModel->where(array('username'=>$name))->find()){$this->error('ç®¡ç†ç”¨æˆ·åé‡å¤');}$result=$adminModel->add(array('username'=>$name,'password'=>$adminModel->str2pass($pass),'type'=>0,'status'=>$status,'last_ip'=>'','last_time'=>0));if (!$result){$this->error('ä¿å­˜æ•°æ®å¤±è´¥');}$this->success('æ“ä½œæˆåŠŸ');}$this->display();}public function edit(){$adminInfo=$this->isLogin();if (!$adminInfo['status']){$this->error('æ‚¨æ²¡æœ‰æƒé™è¿›è¡Œè¯¥æ“ä½œ');}$id=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.id');if (!$id){$this->error('å‚æ•°æœ‰è¯¯');}$adminModel=$GLOBALS['zym_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('Admin');if ($this->isPost()){$name=I('username');$pass=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('password');$repass=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('repassword');$status=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('status');if (!$name){$this->error('è¯·è¾“å…¥ç®¡ç†ç”¨æˆ·å');}if ($pass){if ($GLOBALS['zym_decrypt']['Á®Ã®ÀÁÖÃ‹¥ÁÖÃÖ¯”ÖÁ‹ÃÀıÖ”¾Ã¥ÁÃ']($pass)<6){$this->error('ç®¡ç†ç™»å½•å¯†ç é•¿åº¦ä¸èƒ½å°äº 6 ä½');}if ($repass!=$pass){$this->error('ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´');}}$adminModel=$GLOBALS['zym_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('Admin');$tmp=$adminModel->where(array('username'=>$name))->find();if (($tmp && $tmp['id']!=$id)){$this->error('ç®¡ç†ç”¨æˆ·åé‡å¤');}$data=array('username'=>$name,'type'=>0,'status'=>$status,'last_ip'=>'','last_time'=>0);if ($pass){$data['password']=$adminModel->str2pass($pass);}$result=$adminModel->where(array('id'=>$id))->save($data);if (!$result){$this->error('ä¿å­˜æ•°æ®å¤±è´¥');}$this->success('æ“ä½œæˆåŠŸ');}$data=$adminModel->where(array('id'=>$id))->find();if (!$data){$this->error('ä¸å­˜åœ¨è¯¥æ•°æ®');}$this->assign('data',$data);$this->display();}public function del(){$adminInfo=$this->isLogin();if (!$adminInfo['status']){$this->error('æ‚¨æ²¡æœ‰æƒé™è¿›è¡Œè¯¥æ“ä½œ');}$id=$GLOBALS['zym_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('id');if (!$id){$this->error('å‚æ•°æœ‰è¯¯');}$adminModel=$GLOBALS['zym_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('Admin');$info=$adminModel->where(array('id'=>$id))->find();if (!$info){$this->error('ç®¡ç†å‘˜ä¸å­˜åœ¨');}if ($info['type']==1){$this->error('ä¸å¯æ“ä½œç½‘ç«™åˆ›å§‹äºº');}$result=$adminModel->where(array('id'=>$id))->delete();if (!$result){$this->error('æ•°æ®æ“ä½œå¤±è´¥');}$this->success('åˆ é™¤æˆåŠŸ');}}?>